<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Investor Lens • Fixed Version</title>

<style>
  :root{
    --green:#1F6F63; --green-700:#0E3F38; --muted:#6A7D80; --line:#E6EEEC; --bg:#F6FAF9;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:var(--bg);color:#142a2a;font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial}
  header{padding:14px 16px;display:flex;gap:10px;align-items:center}
  .badge{background:#E9F6F0;color:var(--green-700);font-weight:800;padding:6px 10px;border-radius:8px}
  h1{font-size:18px;margin:0}
  .wrap{padding:0 16px 16px}
  .row{display:grid;grid-template-columns:1.35fr .9fr;gap:12px}
  @media (max-width:980px){.row{grid-template-columns:1fr}}

  /* ===== Map Placeholder ===== */
  #map{height:66vh;min-height:420px;background:#fff;border:1px solid var(--line);border-radius:12px;position:relative;overflow:hidden;z-index:10;
    display:flex;align-items:center;justify-content:center;flex-direction:column}
  .map-placeholder{text-align:center;color:var(--muted);padding:40px}
  .map-placeholder h3{margin:0 0 10px;color:var(--green-700)}
  .heat-demo{width:200px;height:120px;border-radius:8px;margin:10px 0;
    background:linear-gradient(45deg, #4FC3F7 0%, #FFF176 30%, #FFA726 70%, #E53935 100%);
    position:relative}
  .heat-demo::after{content:'Heat Map Demo';position:absolute;bottom:-20px;left:50%;transform:translateX(-50%);
    font-size:12px;color:var(--muted)}

  /* ===== Right Panel ===== */
  .panel{background:#fff;border:1px solid var(--line);border-radius:12px;padding:12px;min-height:66vh;position:relative;z-index:1}
  .kpis{display:flex;gap:8px;margin:0 0 10px}
  .kpi{flex:1;border:1px solid var(--line);border-radius:12px;padding:10px}
  .kpi small{color:var(--muted)} .kpi b{color:var(--green-700);font-size:20px}

  /* ===== Slides with CSS Charts ===== */
  .frame{position:relative;border:1px solid var(--line);border-radius:12px;overflow:hidden;background:#fff}
  .track{display:flex;transition:transform .35s ease;will-change:transform}
  .slide{min-width:100%;padding:12px}
  .slide h3{margin:0 0 8px;font-size:16px}
  .facts{margin:6px 0 0 18px;line-height:1.6}
  
  /* CSS Charts */
  .chart-container{height:180px;margin:10px 0;position:relative;background:#f8faf9;border-radius:8px;padding:15px}
  .css-chart{height:100%;display:flex;align-items:end;justify-content:space-around;gap:8px}
  .bar{background:var(--green);border-radius:4px 4px 0 0;min-width:25px;position:relative;transition:all 0.3s ease}
  .bar:hover{opacity:0.8}
  .bar-label{position:absolute;bottom:-18px;left:50%;transform:translateX(-50%);font-size:11px;color:var(--muted)}
  .bar-value{position:absolute;top:-18px;left:50%;transform:translateX(-50%);font-size:10px;font-weight:600;color:var(--green-700)}
  
  /* Line Chart CSS */
  .line-chart{position:relative;height:100%;border-left:1px solid #ddd;border-bottom:1px solid #ddd}
  .line-path{position:absolute;bottom:0;left:0;right:0;height:100%}
  .line-svg{width:100%;height:100%}
  
  .mini-stats{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin:8px 0}
  .stat{background:#f8faf9;padding:8px;border-radius:6px;text-align:center}
  .stat .label{font-size:11px;color:var(--muted);margin-bottom:2px}
  .stat .value{font-weight:800;color:var(--green-700)}

  .dots{display:flex;justify-content:center;gap:10px;margin-top:10px}
  .dot{width:28px;height:8px;border-radius:999px;background:#E0E7E4;border:0;cursor:pointer;transition:all 0.2s}
  .dot[aria-selected="true"]{background:var(--green)}
  .dot:hover{transform:scale(1.1)}

  /* Status */
  .status{background:#DFF5E1;color:#0E6B3B;padding:8px 12px;border-radius:8px;font-size:12px;font-weight:600;margin-bottom:10px}
  .search-box{background:#fff;border:1px solid var(--line);border-radius:8px;padding:8px;margin:10px 0;display:flex;gap:8px}
  .search-box input{border:0;outline:none;flex:1;padding:4px 8px}
  .search-box button{background:var(--green);color:#fff;border:0;border-radius:4px;padding:6px 12px;cursor:pointer}
</style>
</head>
<body>
<header><div class="badge">PD</div><h1>Investor Lens • CSS Charts Version</h1></header>

<div class="wrap">
  <div class="status">✅ Status: Working with CSS Charts (ไม่ต้องพึ่ง External Libraries)</div>
  
  <div class="row">
    <section>
      <div id="map">
        <div class="map-placeholder">
          <h3>Heat Map Visualization</h3>
          <div class="heat-demo" id="heatDemo"></div>
          <p>Simulated heat map for <span id="areaName">Sukhumvit</span></p>
          <div class="search-box">
            <input id="areaSearch" placeholder="พิมพ์: Sukhumvit, Ekkamai, Thonglor, Rama9" />
            <button id="areaGo">เลือก</button>
          </div>
        </div>
      </div>
    </section>

    <aside class="panel">
      <div class="kpis">
        <div class="kpi"><small>Yield (ย่าน)</small><b id="kpiYield">5.6%</b></div>
        <div class="kpi"><small>Cap Rate (ย่าน)</small><b id="kpiCap">4.2%</b></div>
      </div>

      <div class="frame">
        <div class="track" id="track">
          <!-- Slide 1: Heat Map Info -->
          <section class="slide">
            <h3>วิธีอ่าน Heat Map</h3>
            <ul class="facts">
              <li><strong style="color:#E53935">สีแดง</strong> = กิจกรรมหนาแน่นสูงสุด</li>
              <li><strong style="color:#FFA726">สีส้ม</strong> = กิจกรรมปานกลาง</li>
              <li><strong style="color:#4FC3F7">สีฟ้า</strong> = กิจกรรมน้อย</li>
            </ul>
            <div class="mini-stats">
              <div class="stat"><div class="label">Hot Zones</div><div class="value" id="hotZones">4</div></div>
              <div class="stat"><div class="label">Coverage</div><div class="value">85%</div></div>
            </div>
          </section>

          <!-- Slide 2: Take-up Rate Chart -->
          <section class="slide">
            <h3>Take-up Rate (5 ปี)</h3>
            <div class="chart-container">
              <div class="line-chart">
                <svg class="line-svg" id="lineChart">
                  <polyline id="takeLine" fill="none" stroke="#1F6F63" stroke-width="3" />
                  <text x="10" y="15" font-size="10" fill="#6A7D80">80%</text>
                  <text x="10" y="35" font-size="10" fill="#6A7D80">60%</text>
                  <text x="10" y="55" font-size="10" fill="#6A7D80">40%</text>
                </svg>
              </div>
            </div>
            <div class="mini-stats">
              <div class="stat"><div class="label">Average</div><div class="value" id="avgTakeup">78%</div></div>
              <div class="stat"><div class="label">Trend</div><div class="value" id="trendTakeup">↗ +13%</div></div>
            </div>
          </section>

          <!-- Slide 3: Price Comparison -->
          <section class="slide">
            <h3>Launch vs Resale Price</h3>
            <div class="chart-container">
              <div class="css-chart" id="priceChart">
                <div class="bar" style="height:60%"><div class="bar-label">2020</div><div class="bar-value">150k</div></div>
                <div class="bar" style="height:70%"><div class="bar-label">2021</div><div class="bar-value">160k</div></div>
                <div class="bar" style="height:80%"><div class="bar-label">2022</div><div class="bar-value">170k</div></div>
                <div class="bar" style="height:85%"><div class="bar-label">2023</div><div class="bar-value">175k</div></div>
                <div class="bar" style="height:90%"><div class="bar-label">2024</div><div class="bar-value">180k</div></div>
              </div>
            </div>
            <div class="mini-stats">
              <div class="stat"><div class="label">Launch Avg</div><div class="value" id="launchPrice">180k</div></div>
              <div class="stat"><div class="label">Resale Avg</div><div class="value" id="resalePrice">165k</div></div>
            </div>
          </section>

          <!-- Slide 4: Supply Chart -->
          <section class="slide">
            <h3>Supply vs Demand</h3>
            <div class="chart-container">
              <div class="css-chart" id="supplyChart">
                <div class="bar" style="height:45%; background:#FFA726"><div class="bar-label">2020</div><div class="bar-value">1.8k</div></div>
                <div class="bar" style="height:55%; background:#FFA726"><div class="bar-label">2021</div><div class="bar-value">2.0k</div></div>
                <div class="bar" style="height:65%; background:#FFA726"><div class="bar-label">2022</div><div class="bar-value">2.2k</div></div>
                <div class="bar" style="height:80%; background:#FFA726"><div class="bar-label">2023</div><div class="bar-value">2.4k</div></div>
                <div class="bar" style="height:95%; background:#FFA726"><div class="bar-label">2024</div><div class="bar-value">2.5k</div></div>
              </div>
            </div>
            <div class="mini-stats">
              <div class="stat"><div class="label">New Units</div><div class="value" id="newUnits">2,450</div></div>
              <div class="stat"><div class="label">Demand Index</div><div class="value" id="demandIndex">0.85</div></div>
            </div>
          </section>
        </div>
      </div>
      <div class="dots" role="tablist">
        <button class="dot" data-go="1" aria-selected="true"></button>
        <button class="dot" data-go="2"></button>
        <button class="dot" data-go="3"></button>
        <button class="dot" data-go="4"></button>
      </div>
    </aside>
  </div>
</div>

<script>
/* ================= DATA ================= */
const AREAS = {
  sukhumvit: {
    kpi: {yield: 5.6, cap: 4.2},
    takeup: [65,68,72,74,78],
    prices: {launch: [150,160,170,175,180], resale: [140,150,155,160,165]},
    supply: [1800,2000,2200,2400,2450],
    hotZones: 4,
    heatColor: 'linear-gradient(45deg, #4FC3F7 0%, #FFF176 30%, #FFA726 50%, #E53935 80%)'
  },
  ekkamai: {
    kpi: {yield: 5.2, cap: 3.9},
    takeup: [60,65,70,72,75],
    prices: {launch: [130,140,150,155,160], resale: [125,135,145,148,152]},
    supply: [1200,1350,1500,1650,1800],
    hotZones: 3,
    heatColor: 'linear-gradient(45deg, #4FC3F7 0%, #FFF176 40%, #FFA726 80%)'
  },
  thonglor: {
    kpi: {yield: 5.4, cap: 4.0},
    takeup: [70,72,75,78,80],
    prices: {launch: [200,210,220,225,230], resale: [185,195,205,210,215]},
    supply: [900,1000,1100,1200,1300],
    hotZones: 5,
    heatColor: 'linear-gradient(45deg, #FFF176 0%, #FFA726 30%, #E53935 60%)'
  },
  rama9: {
    kpi: {yield: 5.0, cap: 3.7},
    takeup: [58,62,66,68,70],
    prices: {launch: [140,145,150,158,165], resale: [130,138,142,148,155]},
    supply: [2000,2200,2400,2600,2800],
    hotZones: 3,
    heatColor: 'linear-gradient(45deg, #4FC3F7 0%, #FFF176 50%, #FFA726 90%)'
  }
};

const AREA_NAMES = {sukhumvit:'Sukhumvit', ekkamai:'Ekkamai', thonglor:'Thonglor', rama9:'Rama 9'};
let currentArea = 'sukhumvit';

/* ============== UPDATE FUNCTIONS ============== */
function updateArea(areaKey) {
  if (!AREAS[areaKey]) return;
  currentArea = areaKey;
  const area = AREAS[areaKey];
  
  // Update KPIs
  document.getElementById('kpiYield').textContent = area.kpi.yield + '%';
  document.getElementById('kpiCap').textContent = area.kpi.cap + '%';
  
  // Update area name and heat map
  document.getElementById('areaName').textContent = AREA_NAMES[areaKey];
  document.getElementById('heatDemo').style.background = area.heatColor;
  
  // Update stats
  const lastTakeup = area.takeup[area.takeup.length-1];
  const firstTakeup = area.takeup[0];
  const trendPercent = Math.round(((lastTakeup - firstTakeup) / firstTakeup) * 100);
  
  document.getElementById('avgTakeup').textContent = lastTakeup + '%';
  document.getElementById('trendTakeup').textContent = (trendPercent > 0 ? '↗ +' : '↘ ') + Math.abs(trendPercent) + '%';
  document.getElementById('launchPrice').textContent = area.prices.launch[area.prices.launch.length-1] + 'k';
  document.getElementById('resalePrice').textContent = area.prices.resale[area.prices.resale.length-1] + 'k';
  document.getElementById('newUnits').textContent = area.supply[area.supply.length-1].toLocaleString();
  document.getElementById('hotZones').textContent = area.hotZones;
  document.getElementById('demandIndex').textContent = '0.' + (70 + Math.round(Math.random() * 20));
  
  // Update line chart
  updateLineChart(area.takeup);
  
  // Update price bars
  updatePriceChart(area.prices.launch);
  
  // Update supply bars
  updateSupplyChart(area.supply);
}

function updateLineChart(data) {
  const svg = document.getElementById('lineChart');
  const line = document.getElementById('takeLine');
  const width = 180;
  const height = 120;
  
  const points = data.map((val, i) => {
    const x = (i / (data.length - 1)) * width;
    const y = height - ((val - 50) / 30) * height; // scale 50-80 to full height
    return `${x},${y}`;
  }).join(' ');
  
  line.setAttribute('points', points);
}

function updatePriceChart(data) {
  const chart = document.getElementById('priceChart');
  const bars = chart.querySelectorAll('.bar');
  const max = Math.max(...data);
  
  data.forEach((val, i) => {
    if (bars[i]) {
      const height = (val / max) * 90; // scale to 90% max
      bars[i].style.height = height + '%';
      bars[i].querySelector('.bar-value').textContent = val + 'k';
    }
  });
}

function updateSupplyChart(data) {
  const chart = document.getElementById('supplyChart');
  const bars = chart.querySelectorAll('.bar');
  const max = Math.max(...data);
  
  data.forEach((val, i) => {
    if (bars[i]) {
      const height = (val / max) * 95; // scale to 95% max
      bars[i].style.height = height + '%';
      bars[i].querySelector('.bar-value').textContent = (val/1000).toFixed(1) + 'k';
    }
  });
}

/* ============== SLIDES ============== */
function initSlides() {
  const track = document.getElementById('track');
  const dots = [...document.querySelectorAll('.dot')];
  let current = 1;
  
  const showSlide = (n) => {
    current = Math.max(1, Math.min(4, n));
    track.style.transform = `translateX(${-(current-1)*100}%)`;
    dots.forEach(d => d.setAttribute('aria-selected', d.dataset.go == current ? 'true' : 'false'));
  };
  
  // Dot navigation
  dots.forEach(dot => dot.addEventListener('click', () => showSlide(+dot.dataset.go)));
  
  // Touch/swipe support
  let startX = 0, startY = 0, isDragging = false;
  const frame = track.parentElement;
  
  frame.addEventListener('pointerdown', e => {
    isDragging = true;
    startX = e.clientX;
    startY = e.clientY;
    frame.setPointerCapture(e.pointerId);
  });
  
  frame.addEventListener('pointermove', e => {
    if (!isDragging) return;
    const deltaX = e.clientX - startX;
    const deltaY = e.clientY - startY;
    
    // Show visual feedback
    if (Math.abs(deltaX) > 10 && Math.abs(deltaX) > Math.abs(deltaY)) {
      track.style.transform = `translateX(${-(current-1)*100 + deltaX/5}%)`;
    }
  });
  
  frame.addEventListener('pointerup', e => {
    if (!isDragging) return;
    isDragging = false;
    
    const deltaX = e.clientX - startX;
    if (Math.abs(deltaX) > 50 && Math.abs(deltaX) > Math.abs(e.clientY - startY)) {
      showSlide(current + (deltaX > 0 ? -1 : 1));
    } else {
      // Snap back
      track.style.transform = `translateX(${-(current-1)*100}%)`;
    }
  });
  
  showSlide(1);
}

/* ============== SEARCH ============== */
function initSearch() {
  const input = document.getElementById('areaSearch');
  const button = document.getElementById('areaGo');
  
  const search = () => {
    const query = input.value.toLowerCase().trim();
    let areaKey = 'sukhumvit'; // default
    
    if (query.includes('ekka')) areaKey = 'ekkamai';
    else if (query.includes('thong') || query.includes('ทองหล')) areaKey = 'thonglor';  
    else if (query.includes('rama') || query.includes('พระราม')) areaKey = 'rama9';
    
    updateArea(areaKey);
    input.value = AREA_NAMES[areaKey];
  };
  
  button.addEventListener('click', search);
  input.addEventListener('keypress', e => {
    if (e.key === 'Enter') search();
  });
}

/* ============== INIT ============== */
document.addEventListener('DOMContentLoaded', () => {
  initSlides();
  initSearch();
  updateArea('sukhumvit');
  
  // URL parameter support
  const params = new URLSearchParams(location.search);
  const area = params.get('area');
  if (area && AREAS[area]) {
    updateArea(area);
    document.getElementById('areaSearch').value = AREA_NAMES[area];
  }
});
</script>
</body>
</html>
   
